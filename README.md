# Базы данных в Android

Что нужно сделать

>>> Выделите сущности из предметной области предыдущих модулей.
Продумайте структуру экранов будущего приложения. Потом их необходимо будет реализовать.
Определите операции с сущностями в приложении. Это должны быть операции выборки, добавления,
изменения, удаления записей и выборки данных в соответствии с условием.
~~~ Создайте классы сущностей.
Навесьте аннотации Entity, ColumnInfo и PrimaryKey.
~~~ Добавьте как минимум в один entity-класс поле с собственным типом и напишите конвертер для
корректного сохранения этого поля в БД и его восстановления.
Свяжите сущности с помощью внешних ключей.
Добавьте связи всех типов 1–1, 1–М, М–М.
Создайте Dao, которые будут реализовывать операции из пункта 3.
Создайте класс, наследующийся от RoomDatabase, укажите entity, используемые в БД (из пункта 4)
и создайте методы, возвращающие Dao (из пункта 9).
Создайте объект БД, который является синглтоном.
Вся работа с БД и Dao производится в репозитории. Потому что репозиторий ответственен за логику
работы с данными.
Реализуйте экраны из пункта 2, которые будут работать с данными из БД.
Реализуйте работу с транзакциями для атомарного выполнения набора операций в тех местах, где это
действительно нужно.
Добавьте индексы хотя бы в 1 сущность.
Укажите room.schemaLocation для генерации схем RoomDao.
Измените одну entity. Например, добавьте свойство. Обновите версию схемы БД. В итоге должно
быть как минимум 2 схемы.
Напишите миграцию с первой схемы на вторую. Проверьте, что миграция корректно применяется при
обновлении приложения.
*При обновлении данных в таблице экран, который использует данные в ней, должен автоматически
без явного перезапроса обновить отображаемые данные. Для этого воспользуйтесь query flow или
query observable



Советы и рекомендации

Методы для работы с различными сущностями разделены по разным Dao. Например, методы для
работы с объектами класса User находятся в классе UserDao.
При определениях Entity в качестве tableName, columnName используются строковые константы.
Например - использование контрактов.
При добавлении индексов используйте EXPLAIN QUERY PLAN запрос для проверки, что индекс
действительно используется.


Критерии оценки

Для всех Entity корректно определены первичные ключи, внешние ключи.
Существуют связи 1–1, 1–М, М–М.
Используются композитные сущности с полями, помеченными аннотациями Relation.
В entity-классах должно присутствовать поле с собственным типом, для которого нужно написать
конвертер.
В Dao присутствуют методы выборки, добавления, изменения, удаления записей.
В Dao существуют методы выборки данных в соответствии с условием, значение для условия должно
передаваться в парметрах метода Dao.
Используются индексы, которые позволяют ускорить запросы.
Использованы транзакции для атомарного выполнения набора операций.
Созданы несколько версий схем и написана миграция. Схемы для Room добавлены в git.
Объект БД является синглтоном.
Работа с БД происходит без блокировки главного потока — например, с помощью корутин.